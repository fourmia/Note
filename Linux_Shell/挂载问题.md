<!--
 * @Author: LiZedong 15516926476@163.com
 * @Date: 2023-03-08 13:53:56
 * @LastEditors: LiZedong 15516926476@163.com
 * @LastEditTime: 2023-03-09 13:57:00
 * @FilePath: \A个人笔记\Linux_Shell\挂载问题.md
 * @Description: 
 * 
 * Copyright (c) 2023 by ${git_name_email}, All Rights Reserved. 
-->
从目的来看对于共享文件的挂载主要分为两种：

1. 临时挂载：也可称为一次性挂载，使用次数不多
2. 开机挂载：每次电脑重启可自动进行文件挂载

由于临时挂载操作简单，通常不会导致系统问题，在此不作讨论，后续所指挂载方式均为开机挂载
***

**当前采用的挂载方式**

`/etc/fstab` : 根据个人当前了解的挂载方式，大多数人采用编辑`/etc/fstab`添加新的挂载记录，通过设定状态为`auto`来进行开机挂载。

**存在的问题**

根据个人了解，使用`/etc/fstab`挂载，导致服务器无法正常开机的情况至少出现过两次，需要进入救援模式进行移除异常挂载后才可正常开机。出现这种情况个人猜测·的原因是进行`/etc/fstab`中文件挂载的原因是在加载操作系统内核之前的，异常的挂载导致硬件自检无法通过，从而开机异常。**❗若非要采用此方式挂载，挂载完成后需使用`mount -a`进行验证，确保挂载命令没有异常**。参考链接：[为什么不推荐使用/etc/fstab](https://www.jianshu.com/p/af49a5d0553f)

**解决方案**

1. 对于老版本操作系统，大都提供了采用`/etc/rc.d/rc.local`，此类教程颇多，参考使用`mount -t XXXX`进行挂载即可，`rc.local`工作时机在操作系统加载之后。可放心食用

2. 对于新版本操作系统，需要以`systemd`服务的形式进行，此处进行较为详细的说明（在`OPEN SUSE15.4`上进行验证）参考资料：[OpenSUSE配置开机启动](https://jiuaidu.com/jianzhan/918670/),[systemd详解](https://blog.csdn.net/stone_fall/article/details/108630115)。

    + 编辑 `/usr/lib/systemd/system/after-local.service`

        ```sh
        [Unit]
        Description=/etc/init.d/after.local Compatibility
        ConditionFileIsExecutable=/etc/init.d/after.local  
        After=getty.target

        [Service]
        Type=idle    #命令运行时机
        ExecStart=/etc/init.d/after.local   #实际运行的脚本位置，按实际修改，若为开机挂载保持不变即可
        TimeoutSec=0
        RemainAfterExit=yes

        [Install]   # 照着写的，我也不懂
        WantedBy=multi-user.target
        ```

    + 新增`/etc/init.d/after.local`,此处应当是为了与先前的系统兼容，有兴趣可以了解下,填写`shell`

        ```bash
        #!/bin/bash
        #echo 'this is a mount start'
        mount -t cifs -o defaults,auto,username=root,password='xxx' //10.181.xx.xxx/data /mnt/ftp_xxx   # 此处进行挂载命令，按需求来
        #echo 'this is a mount end'                      
        ```

    + 检查权限并修改`chmod 755 after.local`(大坑)

    + 手动运行服务 `systemctl start after-local.service`

    + 查看服务状态 `systemctl status after-local.service`,若异常信息为`xxx after.local not met`则是权限问题没跑了，至此应当服务正常了，待开机验证


